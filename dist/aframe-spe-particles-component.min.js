!function i(a,o,s){function n(t,e){if(!o[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=o[t]={exports:{}},a[t][0].call(r.exports,function(e){return n(a[t][1][e]||e)},r,r.exports,i,a,o,s)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)n(s[e]);return n}({1:[function(e,t,r){let i=e("./lib/SPE.js"),a=e=>new THREE.Vector3(e.x,e.y,e.z),o=e=>new THREE.Color(e);e=e=>"string"==typeof e?e.split(",").map(e=>parseFloat(e)):e;let s=e=>parseFloat(e)/180*Math.PI,n=e=>180*parseFloat(e)/Math.PI,l=1;AFRAME.registerComponent("spe-particles",{schema:{enableInEditor:{default:!1,description:"enable the emitter while the editor is active (i.e. while scene is paused)"},enabled:{default:!0,description:"enable/disable the emitter"},frustumCulled:{default:!1,description:"enable/disable frustum culling"},texture:{type:"map",description:"texture to be used for each particle, may be a spritesheet"},textureFrames:{type:"vec2",default:{x:1,y:1},description:"x and y frames for a spritesheet. each particle will transition through every frame of the spritesheet over its lifetime (see textureFramesLoop)"},textureFrameCount:{type:"int",default:-1,description:"number of frames in the spritesheet, negative numbers default to textureFrames.x * textureFrames.y"},textureFrameLoop:{type:"int",default:1,description:"number of times the spritesheet should be looped over the lifetime of a particle"},blending:{default:"normal",oneOf:["no","normal","additive","subtractive","multiply","custom"],description:"blending mode, when drawing particles",parse:e=>(e||"no").toLowerCase()},hasPerspective:{default:!0,description:"if true, particles will be larger the closer they are to the camera. setting this to false cancels the effect of emitterScale"},useTransparency:{default:!0,description:"should the particles be rendered with transparency?"},alphaTest:{default:0,min:0,max:1,description:"alpha values below the alphaTest threshold are considered invisible"},depthWrite:{default:!1,description:"if true, particles write their depth into the depth buffer. this should be false if we use transparent particles"},depthTest:{default:!0,description:"if true, don't render a particle's pixels if something is closer in the depth buffer"},affectedByFog:{default:!0,description:"if true, the particles are affected by THREE js fog"},emitterScale:{default:100,description:"global scaling factor for all particles from the emitter"},relative:{default:"local",oneOf:["local","world"],description:"world relative particles move relative to the world, while local particles move relative to the emitter (i.e. if the emitter moves, all particles move with it)",parse:e=>(e||"local").toLowerCase()},particleCount:{type:"int",default:100,description:"maximum number of particles for this emitter"},duration:{default:-1,description:"duration of the emitter (seconds), if less than 0 then continuously emit particles"},distribution:{default:"BOX",oneOf:["BOX","SPHERE","DISC"],description:"distribution for particle positions, velocities and acceleration. will be overriden by specific '...Distribution' attributes",parse:e=>(e||"BOX").toUpperCase()},activeMultiplier:{default:1,min:0,description:"multiply the rate of particles emission, if larger than 1 then the particles will be emitted in bursts. note, very large numbers will emit all particles at once"},direction:{default:"forward",oneOf:["forward","backward"],description:"make the emitter operate forward or backward in time",parse:e=>(e||"forward").toLowerCase()},maxAge:{default:1,description:"maximum age of a particle before reusing"},maxAgeSpread:{default:0,description:"variance for the 'maxAge' attribute"},positionDistribution:{default:"NONE",oneOf:["NONE","BOX","SPHERE","DISC"],description:"distribution of particle positions, disc and sphere will use the radius attributes. For box particles emit at 0,0,0, for sphere they emit on the surface of the sphere and for disc on the edge of a 2D disc on the XY plane",parse:e=>(e||"NONE").toUpperCase()},positionSpread:{type:"vec3",description:"particles are positioned within +- of these local bounds. for sphere and disc distributions only the x axis is used"},positionOffset:{type:"vec3",description:"fixed offset to the apply to the emitter relative to its parent entity"},randomizePosition:{default:!1,description:"if true, re-randomize position when re-spawning a particle, can incur a performance hit"},radius:{default:1,min:0,description:"radius of the disc or sphere emitter (ignored for box). note radius of 0 will prevent velocity and acceleration if they use a sphere or disc distribution"},radiusScale:{type:"vec3",default:{x:1,y:1,z:1},description:"scales the emitter for sphere and disc shapes to form oblongs and ellipses"},velocityDistribution:{default:"NONE",oneOf:["NONE","BOX","SPHERE","DISC"],description:"distribution of particle velocities, for disc and sphere, only the x component will be used. if set to NONE use the 'distribution' attribute for velocityDistribution",parse:e=>(e||"NONE").toUpperCase()},velocity:{type:"vec3",description:"for sphere and disc distributions, only the x axis is used"},velocitySpread:{type:"vec3",description:"variance for the velocity"},randomizeVelocity:{default:!1,description:"if true, re-randomize velocity when re-spawning a particle, can incur a performance hit"},accelerationDistribution:{default:"NONE",oneOf:["NONE","BOX","SPHERE","DISC"],description:"distribution of particle acceleration, for disc and sphere, only the x component will be used. if set to NONE use the 'distribution' attribute for accelerationDistribution",parse:e=>(e||"NONE").toUpperCase()},acceleration:{type:"vec3",description:"for sphere and disc distributions, only the x axis is used"},accelerationSpread:{type:"vec3",description:"spread of the particle's acceleration. for sphere and disc distributions, only the x axis is used"},randomizeAcceleration:{default:!1,description:"if true, re-randomize acceleration when re-spawning a particle, can incur a performance hit"},drag:{default:0,min:0,max:1,description:"apply resistance to moving the particle, 0 is no resistance, 1 is full resistance, particle will stop moving at half of it's maxAge"},dragSpread:{default:0,description:"spread to apply to the drag attribute"},randomizeDrag:{default:!1,description:"if true, re-randomize drag when re-spawning a particle, can incur a performance hit"},wiggle:{default:0,description:"extra distance the particle moves over its lifetime"},wiggleSpread:{default:0,description:"+- spread for the wiggle attribute"},rotation:{default:0,description:"rotation in degrees",parse:e=>s(e),stringify:e=>n(e)},rotationSpread:{default:0,description:"rotation variance in degrees",parse:e=>s(e),stringify:e=>n(e)},rotationAxis:{type:"vec3",description:"local axis when using rotation"},rotationAxisSpread:{type:"vec3",description:"variance in the axis of rotation"},rotationStatic:{default:!1,description:"if true, the particles are fixed at their initial rotation value. if false, the particle will rotate from 0 to the 'rotation' value"},randomizeRotation:{default:!1,description:"if true, re-randomize rotation when re-spawning a particle, can incur a performance hit"},color:{type:"array",default:["#fff"],description:"array of colors over the particle's lifetime, max 4 elements"},colorSpread:{type:"array",default:[],description:"spread to apply to colors, spread an array of vec3 (r g b) with 0 for no spread. note the spread will be re-applied through-out the lifetime of the particle",parse:e=>"string"==typeof e?e.split(",").map(AFRAME.utils.coordinates.parse):e,stringify:e=>e.map(AFRAME.utils.coordinates.stringify).join(",")},randomizeColor:{default:!1,description:"if true, re-randomize colour when re-spawning a particle, can incur a performance hit"},opacity:{type:"array",default:[1],description:"opacity over the particle's lifetime, max 4 elements",parse:e},opacitySpread:{type:"array",default:[0],description:"spread in opacity over the particle's lifetime, max 4 elements",parse:e},randomizeOpacity:{default:!1,description:"if true, re-randomize opacity when re-spawning a particle, can incur a performance hit"},size:{type:"array",default:[1],description:"array of sizes over the particle's lifetime, max 4 elements",parse:e},sizeSpread:{type:"array",default:[0],description:"spread in size over the particle's lifetime, max 4 elements",parse:e},randomizeSize:{default:!1,description:"if true, re-randomize size when re-spawning a particle, can incur a performance hit"},angle:{type:"array",default:[0],description:"2D rotation of the particle over the particle's lifetime, max 4 elements",parse:e},angleSpread:{type:"array",default:[0],description:"spread in angle over the particle's lifetime, max 4 elements",parse:e},randomizeAngle:{default:!1,description:"if true, re-randomize angle when re-spawning a particle, can incur a performance hit"}},multiple:!0,init:function(){this.particleGroup=null,this.referenceEl=null,this.pauseTickId=void 0,this.emitterID=l++,this.pauseTick=this.pauseTick.bind(this),this.defaultTexture=new THREE.DataTexture(new Uint8Array(4).fill(255),1,1,THREE.RGBAFormat),this.defaultTexture.needsUpdate=!0},update:function(e){e=((e,t)=>{var r,i,a={},o=Object.keys(e);for(r in t)o.includes[r]||o.push(r);for(i of o){var s=e[i],n=t[i],l=s&&n&&(s.constructor==Object&&n.constructor===Object||Array.isArray(s)&&Array.isArray(n));(l&&!AFRAME.utils.deepEqual(s,n)||!l&&s!==n)&&(a[i]=n)}return a})(e,this.data);Object.keys(e).some(e=>!["enabled","enableInEditor"].includes(e))&&(this.removeParticleSystem(),this.addParticleSystem()),this.data.enabled?this.startParticles():this.stopParticles(),!this.isPlaying&&this.data.enableInEditor?this.setupPauseTick():this.shutdownPauseTick()},remove:function(){this.removeParticleSystem()},tick:function(e,t){this.tickParticleSystem(t)},pause:function(){this.setupPauseTick()},play:function(){this.shutdownPauseTick()},setupPauseTick:function(){!this.pauseTickId&&this.data.enableInEditor&&this.pauseTick(!0)},shutdownPauseTick:function(){this.pauseTickId&&(clearTimeout(this.pauseTickId),this.pauseTickId=void 0)},pauseTick:function(){this.tickParticleSystem(33),this.pauseTickId=setTimeout(this.pauseTick,33)},tickParticleSystem:function(e){var t;"world"===this.data.relative&&(t=a(this.data.positionOffset).applyMatrix4(this.el.object3D.matrixWorld),this.particleGroup.emitters[0].position.value=t),this.particleGroup.tick(e/1e3)},addParticleSystem:function(){var e=this.data,t=new THREE.TextureLoader,t=e.texture?t.load(e.texture):this.defaultTexture;let r=e.blending||"No";!(r=r.charAt(0).toUpperCase()+r.substring(1).toLowerCase()+"Blending")in THREE&&console.error(`unknown blending mode "${e.blending}"`),console.assert(null===this.particleGroup);t={texture:{value:t,frames:(t=e.textureFrames,new THREE.Vector2(t.x,t.y)),frameCount:0<=e.textureFrameCount?e.textureFrameCount:void 0,loop:e.textureFrameLoop},maxParticleCount:e.particleCount,blending:THREE[r],hasPerspective:e.hasPerspective,transparent:e.useTransparency,alphaTest:e.alphaTest,depthWrite:e.depthWrite,depthTest:e.depthTest,fog:e.affectedByFog,scale:e.emitterScale},this.particleGroup=new i.Group(t),t={type:i.distributions[e.distribution in i.distributions?e.distribution:"BOX"],particleCount:e.particleCount,duration:0<=e.duration?e.duration:null,activeMultiplier:e.activeMultiplier,direction:"forward"===e.direction?1:-1,maxAge:{value:e.maxAge,spread:e.maxAgeSpread},position:{value:"World"===e.relative?a(this.data.positionOffset).applyMatrix4(this.el.object3D.matrixWorld):a(e.positionOffset).applyMatrix4(this.el.object3D.matrix),radius:e.radius,radiusScale:a(e.radiusScale),spread:a(e.positionSpread),distribution:i.distributions[e.positionDistribution in i.distributions?e.positionDistribution:e.distribution],randomise:e.randomizePosition},velocity:{value:a(e.velocity),spread:a(e.velocitySpread),distribution:i.distributions[e.velocityDistribution in i.distributions?e.velocityDistribution:e.distribution],randomise:e.randomizeVelocity},acceleration:{value:a(e.acceleration),spread:a(e.accelerationSpread),distribution:i.distributions[e.accelerationDistribution in i.distributions?e.accelerationDistribution:e.distribution],randomise:e.randomizeAcceleration},drag:{value:e.drag,spread:e.dragSpread,randomise:e.randomizeDrag},wiggle:{value:e.wiggle,spread:e.wiggleSpread},rotation:{axis:a(e.rotationAxis),axisSpread:a(e.rotationAxisSpread),angle:e.rotation,angleSpread:e.rotationSpread,static:e.rotationStatic,randomise:e.randomizeRotation},color:{value:0<e.color.length?e.color.map(e=>o(e)):[o("#fff")],spread:0<e.colorSpread.length?e.colorSpread.map(e=>a(e)):void 0,randomise:e.randomizeColor},opacity:{value:e.opacity,spread:e.opacitySpread,randomise:e.randomizeOpacity},size:{value:e.size,spread:e.sizeSpread,randomise:e.randomizeSize},angle:{value:e.angle,spread:e.angleSpread,randomise:e.randomizeAngle}},t=new i.Emitter(t);this.particleGroup.addEmitter(t),this.particleGroup.mesh.frustumCulled=e.frustumCulled,this.referenceEl="world"===e.relative?this.el.sceneEl:this.el,this.referenceEl.setObject3D(this.getEmitterName(),this.particleGroup.mesh)},removeParticleSystem:function(){this.particleGroup&&(this.referenceEl.removeObject3D(this.getEmitterName()),this.particleGroup=null)},startParticles:function(){this.particleGroup.emitters.forEach(e=>e.enable())},stopParticles:function(){this.particleGroup.emitters.forEach(e=>e.disable())},getEmitterName:function(){return"spe-particles"+this.emitterID}})},{"./lib/SPE.js":2}],2:[function(e,t,r){var i,a,o,s,l,u,p,c={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};"function"==typeof define&&define.amd?define("spe",c):void 0!==r&&void 0!==t&&(t.exports=c),c.TypedArrayHelper=function(e,t,r,i){this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0},c.TypedArrayHelper.constructor=c.TypedArrayHelper,c.TypedArrayHelper.prototype.setSize=function(e,t){var r=this.array.length;return t||(e*=this.componentSize),e<r?this.shrink(e):r<e?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},c.TypedArrayHelper.prototype.shrink=function(e){return this.array=this.array.subarray(0,e),this.size=e,this},c.TypedArrayHelper.prototype.grow=function(e){var t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this},c.TypedArrayHelper.prototype.splice=function(e,t){e*=this.componentSize,t*=this.componentSize;for(var r=[],i=this.array,a=i.length,o=0;o<a;++o)(o<e||t<=o)&&r.push(i[o]);return this.setFromArray(0,r),this},c.TypedArrayHelper.prototype.setFromArray=function(e,t){var r=e+t.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this},c.TypedArrayHelper.prototype.setVec2=function(e,t){return this.setVec2Components(e,t.x,t.y)},c.TypedArrayHelper.prototype.setVec2Components=function(e,t,r){var i=this.array,e=this.indexOffset+e*this.componentSize;return i[e]=t,i[e+1]=r,this},c.TypedArrayHelper.prototype.setVec3=function(e,t){return this.setVec3Components(e,t.x,t.y,t.z)},c.TypedArrayHelper.prototype.setVec3Components=function(e,t,r,i){var a=this.array,e=this.indexOffset+e*this.componentSize;return a[e]=t,a[e+1]=r,a[e+2]=i,this},c.TypedArrayHelper.prototype.setVec4=function(e,t){return this.setVec4Components(e,t.x,t.y,t.z,t.w)},c.TypedArrayHelper.prototype.setVec4Components=function(e,t,r,i,a){var o=this.array,e=this.indexOffset+e*this.componentSize;return o[e]=t,o[e+1]=r,o[e+2]=i,o[e+3]=a,this},c.TypedArrayHelper.prototype.setMat3=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},c.TypedArrayHelper.prototype.setMat4=function(e,t){return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},c.TypedArrayHelper.prototype.setColor=function(e,t){return this.setVec3Components(e,t.r,t.g,t.b)},c.TypedArrayHelper.prototype.setNumber=function(e,t){return this.array[this.indexOffset+e*this.componentSize]=t,this},c.TypedArrayHelper.prototype.getValueAtIndex=function(e){return this.array[this.indexOffset+e]},c.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){return this.array.subarray(this.indexOffset+e*this.componentSize)},c.ShaderAttribute=function(e,t,r){var i=c.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},c.ShaderAttribute.constructor=c.ShaderAttribute,c.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},c.ShaderAttribute.prototype.setUpdateRange=function(e,t){this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},c.ShaderAttribute.prototype.flagUpdate=function(){var e=this.bufferAttribute;e.addUpdateRange(this.updateMin,Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length)),e.needsUpdate=!0},c.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMin=0,this.updateMax=0},c.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer},c.ShaderAttribute.prototype.splice=function(e,t){this.typedArray.splice(e,t),this.forceUpdateAll()},c.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.clearUpdateRanges(),this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},c.ShaderAttribute.prototype._ensureTypedArray=function(e){null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new c.TypedArrayHelper(this.arrayType,e,this.componentSize)))},c.ShaderAttribute.prototype._createBufferAttribute=function(e){this._ensureTypedArray(e),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,81<=parseFloat(THREE.REVISION)&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),this.bufferAttribute.needsUpdate=!0):(this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer)},c.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length},c.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D tex;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( tex, vUv );"].join("\n")},c.shaders={vertex:[c.shaderChunks.defines,c.shaderChunks.uniforms,c.shaderChunks.attributes,c.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,c.shaderChunks.branchAvoidanceFunctions,c.shaderChunks.unpackColor,c.shaderChunks.unpackRotationAxis,c.shaderChunks.floatOverLifetime,c.shaderChunks.colorOverLifetime,c.shaderChunks.paramFetchingFunctions,c.shaderChunks.forceFetchingFunctions,c.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[c.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,c.shaderChunks.varyings,c.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",c.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},c.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){if(Array.isArray(e)){for(var i=e.length-1;0<=i;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),t=this.clamp(e._spread.length,t,r),r=Math.max(i,t);e._value.length!==r&&(e._value=this.interpolateArray(e._value,r)),e._spread.length!==r&&(e._spread=this.interpolateArray(e._spread,r))},interpolateArray:function(e,t){for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],a=(r-1)/(t-1),o=1;o<t-1;++o){var s=o*a,n=Math.floor(s),l=Math.ceil(s);i[o]=this.lerpTypeAgnostic(e[n],e[l],s-n)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){var r=e,r=t?1e-5*Math.random()*10:1e-5;return r=e<0&&-1e-5<e?-r:r},lerpTypeAgnostic:function(e,t,r){var i,a=this.types;return typeof e===a.NUMBER&&typeof t===a.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color?((i=e.clone()).r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){return e+(t-e)*r},roundToNearestMultiple:function(e,t){var r;return 0===t||0==(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,a){var o=r.x+(Math.random()*i.x-.5*i.x),s=r.y+(Math.random()*i.y-.5*i.y),r=r.z+(Math.random()*i.z-.5*i.z);a&&(o=.5*-a.x+this.roundToNearestMultiple(o,a.x),s=.5*-a.y+this.roundToNearestMultiple(s,a.y),r=.5*-a.z+this.roundToNearestMultiple(r,a.z)),e.typedArray.setVec3Components(t,o,s,r)},randomColor:function(e,t,r,i){var a=r.r+Math.random()*i.x,o=r.g+Math.random()*i.y,r=r.b+Math.random()*i.z,a=this.clamp(a,0,1),o=this.clamp(o,0,1),r=this.clamp(r,0,1);e.typedArray.setVec3Components(t,a,o,r)},randomColorAsHex:(p=new THREE.Color,function(e,t,r,i){for(var a=r.length,o=[],s=0;s<a;++s){var n=i[s];p.copy(r[s]),p.r+=Math.random()*n.x-.5*n.x,p.g+=Math.random()*n.y-.5*n.y,p.b+=Math.random()*n.z-.5*n.z,p.r=this.clamp(p.r,0,1),p.g=this.clamp(p.g,0,1),p.b=this.clamp(p.b,0,1),o.push(p.getHex())}e.typedArray.setVec4Components(t,o[0],o[1],o[2],o[3])}),randomVector3OnSphere:function(e,t,r,i,a,o,s,n){var l=2*Math.random()-1,u=6.2832*Math.random(),p=Math.sqrt(1-l*l),i=this.randomFloat(i,a),a=0;s&&(i=Math.round(i/s)*s),a=p*Math.cos(u)*i,s=p*Math.sin(u)*i,a=(a*=o.x)+r.x,e.typedArray.setVec3Components(t,a,s*o.y+r.y,l*i*o.z+r.z)},seededRandom:function(e){e=1e4*Math.sin(e);return e-(0|e)},randomVector3OnDisc:function(e,t,r,i,a,o,s){var n=6.2832*Math.random(),i=Math.abs(this.randomFloat(i,a)),a=0,l=0;s&&(i=Math.round(i/s)*s),a=Math.cos(n)*i,s=Math.sin(n)*i,a=(a*=o.x)+r.x,e.typedArray.setVec3Components(t,a,s*o.y+r.y,l+=r.z)},randomDirectionVector3OnSphere:(u=new THREE.Vector3,function(e,t,r,i,a,o,s,n){u.copy(o),u.x-=r,u.y-=i,u.z-=a,u.normalize().multiplyScalar(-this.randomFloat(s,n)),e.typedArray.setVec3Components(t,u.x,u.y,u.z)}),randomDirectionVector3OnDisc:(l=new THREE.Vector3,function(e,t,r,i,a,o,s,n){l.copy(o),l.x-=r,l.y-=i,l.z-=a,l.normalize().multiplyScalar(-this.randomFloat(s,n)),e.typedArray.setVec3Components(t,l.x,l.y,0)}),getPackedRotationAxis:(i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Color,s=new THREE.Vector3(1,1,1),function(e,t){return i.copy(e).normalize(),a.copy(t).normalize(),i.x+=.5*-t.x+Math.random()*t.x,i.y+=.5*-t.y+Math.random()*t.y,i.z+=.5*-t.z+Math.random()*t.z,i.normalize().add(s).multiplyScalar(.5),o.setRGB(i.x,i.y,i.z),o.getHex()})},c.Group=function(e){var t=c.utils,r=t.types;(e=t.ensureTypedArg(e,r.OBJECT,{})).texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.MathUtils.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(e.texture.frames,THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={tex:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:c.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:1<this.textureFrames.x||1<this.textureFrames.y},this.attributes={position:new c.ShaderAttribute("v3",!0),acceleration:new c.ShaderAttribute("v4",!0),velocity:new c.ShaderAttribute("v3",!0),rotation:new c.ShaderAttribute("v4",!0),rotationCenter:new c.ShaderAttribute("v3",!0),params:new c.ShaderAttribute("v4",!0),size:new c.ShaderAttribute("v4",!0),angle:new c.ShaderAttribute("v4",!0),color:new c.ShaderAttribute("v4",!0),opacity:new c.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:c.shaders.vertex,fragmentShader:c.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},c.Group.constructor=c.Group,c.Group.prototype._updateDefines=function(){for(var e,t=this.emitters,r=t.length-1,i=this.defines;0<=r;--r)e=t[r],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread);this.material.needsUpdate=!0},c.Group.prototype._applyAttributesToGeometry=function(){var e,t,r,i=this.attributes,a=this.geometry,o=a.attributes;for(r in i)i.hasOwnProperty(r)&&(e=i[r],(t=o[r])?t.array=e.typedArray.array:a.setAttribute(r,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},c.Group.prototype.addEmitter=function(e){if(e instanceof c.Emitter==!1)console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);else if(-1<this.emitterIDs.indexOf(e.uuid))console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t,r=this.attributes,i=this.particleCount,a=i+e.particleCount;for(t in this.particleCount=a,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(i),e.group=this,e.attributes=this.attributes,r)r.hasOwnProperty(t)&&r[t]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=i;o<a;++o)e._assignPositionValue(o),e._assignForceValue(o,"velocity"),e._assignForceValue(o,"acceleration"),e._assignAbsLifetimeValue(o,"opacity"),e._assignAbsLifetimeValue(o,"size"),e._assignAngleValue(o),e._assignRotationValue(o),e._assignParamsValue(o),e._assignColorValue(o);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}},c.Group.prototype.removeEmitter=function(e){var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof c.Emitter==!1)console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e);else if(-1===t)console.error("Emitter does not exist in this group. Will not remove.");else{for(var r,i=e.attributeOffset,a=i+e.particleCount,o=this.attributes.params.typedArray,s=i;s<a;++s)o.array[4*s]=0,o.array[4*s+1]=0;for(r in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(r)&&this.attributes[r].splice(i,a);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}},c.Group.prototype.getFromPool=function(){var e=this._pool,t=this._createNewWhenPoolEmpty;return e.length?e.pop():t?(e=new c.Emitter(this._poolCreationSettings),this.addEmitter(e),e):null},c.Group.prototype.releaseIntoPool=function(e){if(e instanceof c.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},c.Group.prototype.getPool=function(){return this._pool},c.Group.prototype.addPool=function(e,t,r){var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!r;for(var a=0;a<e;++a)i=Array.isArray(t)?new c.Emitter(t[a]):new c.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this},c.Group.prototype._triggerSingleEmitter=function(e){var t=this.getFromPool(),r=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),r.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},c.Group.prototype.triggerPoolEmitter=function(e,t){if("number"==typeof e&&1<e)for(var r=0;r<e;++r)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},c.Group.prototype._updateUniforms=function(e){this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},c.Group.prototype._resetBufferRanges=function(){for(var e=this.attributeKeys,t=this.attributeCount-1,r=this.attributes;0<=t;--t)r[e[t]].resetUpdateRange()},c.Group.prototype._updateBuffers=function(e){for(var t,r,i=this.attributeKeys,a=this.attributeCount-1,o=this.attributes,s=e.bufferUpdateRanges;0<=a;--a)t=s[r=i[a]],(r=o[r]).setUpdateRange(t.min,t.max),r.flagUpdate()},c.Group.prototype.tick=function(e){var t=this.emitters,r=t.length,i=e||this.fixedTimeStep,a=this.attributeKeys,o=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var s,n=0;n<r;++n)(s=t[n]).tick(i),this._updateBuffers(s);if(!0===this._attributesNeedDynamicReset){for(n=this.attributeCount-1;0<=n;--n)o[a[n]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(n=this.attributeCount-1;0<=n;--n)o[a[n]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},c.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this},c.Emitter=function(e){var t,r=c.utils,i=r.types,a=c.valueOverLifetimeLength;for(t in(e=r.ensureTypedArg(e,i.OBJECT,{})).position=r.ensureTypedArg(e.position,i.OBJECT,{}),e.velocity=r.ensureTypedArg(e.velocity,i.OBJECT,{}),e.acceleration=r.ensureTypedArg(e.acceleration,i.OBJECT,{}),e.radius=r.ensureTypedArg(e.radius,i.OBJECT,{}),e.drag=r.ensureTypedArg(e.drag,i.OBJECT,{}),e.rotation=r.ensureTypedArg(e.rotation,i.OBJECT,{}),e.color=r.ensureTypedArg(e.color,i.OBJECT,{}),e.opacity=r.ensureTypedArg(e.opacity,i.OBJECT,{}),e.size=r.ensureTypedArg(e.size,i.OBJECT,{}),e.angle=r.ensureTypedArg(e.angle,i.OBJECT,{}),e.wiggle=r.ensureTypedArg(e.wiggle,i.OBJECT,{}),e.maxAge=r.ensureTypedArg(e.maxAge,i.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.MathUtils.generateUUID(),this.type=r.ensureTypedArg(e.type,i.NUMBER,c.distributions.BOX),this.position={_value:r.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:r.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:r.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:r.ensureTypedArg(e.position.distribution,i.NUMBER,this.type),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1),_radius:r.ensureTypedArg(e.position.radius,i.NUMBER,10),_radiusScale:r.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:r.ensureTypedArg(e.position.distributionClamp,i.NUMBER,0)},this.velocity={_value:r.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:r.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:r.ensureTypedArg(e.velocity.distribution,i.NUMBER,this.type),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.acceleration={_value:r.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:r.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:r.ensureTypedArg(e.acceleration.distribution,i.NUMBER,this.type),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.drag={_value:r.ensureTypedArg(e.drag.value,i.NUMBER,0),_spread:r.ensureTypedArg(e.drag.spread,i.NUMBER,0),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.wiggle={_value:r.ensureTypedArg(e.wiggle.value,i.NUMBER,0),_spread:r.ensureTypedArg(e.wiggle.spread,i.NUMBER,0)},this.rotation={_axis:r.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:r.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:r.ensureTypedArg(e.rotation.angle,i.NUMBER,0),_angleSpread:r.ensureTypedArg(e.rotation.angleSpread,i.NUMBER,0),_static:r.ensureTypedArg(e.rotation.static,i.BOOLEAN,!1),_center:r.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.maxAge={_value:r.ensureTypedArg(e.maxAge.value,i.NUMBER,2),_spread:r.ensureTypedArg(e.maxAge.spread,i.NUMBER,0)},this.color={_value:r.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:r.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.opacity={_value:r.ensureArrayTypedArg(e.opacity.value,i.NUMBER,1),_spread:r.ensureArrayTypedArg(e.opacity.spread,i.NUMBER,0),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.size={_value:r.ensureArrayTypedArg(e.size.value,i.NUMBER,1),_spread:r.ensureArrayTypedArg(e.size.spread,i.NUMBER,0),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.angle={_value:r.ensureArrayTypedArg(e.angle.value,i.NUMBER,0),_spread:r.ensureArrayTypedArg(e.angle.spread,i.NUMBER,0),_randomise:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)},this.particleCount=r.ensureTypedArg(e.particleCount,i.NUMBER,100),this.duration=r.ensureTypedArg(e.duration,i.NUMBER,null),this.isStatic=r.ensureTypedArg(e.isStatic,i.BOOLEAN,!1),this.activeMultiplier=r.ensureTypedArg(e.activeMultiplier,i.NUMBER,1),this.direction=r.ensureTypedArg(e.direction,i.NUMBER,1),this.alive=r.ensureTypedArg(e.alive,i.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:r.ensureTypedArg(e.position.randomise,i.BOOLEAN,!1)||r.ensureTypedArg(e.radius.randomise,i.BOOLEAN,!1),velocity:r.ensureTypedArg(e.velocity.randomise,i.BOOLEAN,!1),acceleration:r.ensureTypedArg(e.acceleration.randomise,i.BOOLEAN,!1)||r.ensureTypedArg(e.drag.randomise,i.BOOLEAN,!1),rotation:r.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),rotationCenter:r.ensureTypedArg(e.rotation.randomise,i.BOOLEAN,!1),size:r.ensureTypedArg(e.size.randomise,i.BOOLEAN,!1),color:r.ensureTypedArg(e.color.randomise,i.BOOLEAN,!1),opacity:r.ensureTypedArg(e.opacity.randomise,i.BOOLEAN,!1),angle:r.ensureTypedArg(e.angle.randomise,i.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(t)&&(this.updateCounts[this.updateMap[t]]=0,this.updateFlags[this.updateMap[t]]=!1,this._createGetterSetters(this[t],t));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,r.ensureValueOverLifetimeCompliance(this.color,a,a),r.ensureValueOverLifetimeCompliance(this.opacity,a,a),r.ensureValueOverLifetimeCompliance(this.size,a,a),r.ensureValueOverLifetimeCompliance(this.angle,a,a)},c.Emitter.constructor=c.Emitter,c.Emitter.prototype._createGetterSetters=function(e,o){var t,r,s=this;for(t in e)e.hasOwnProperty(t)&&(r=t.replace("_",""),Object.defineProperty(e,r,{get:(e=>function(){return this[e]})(t),set:(a=>function(e){var t=s.updateMap[o],r=this[a],i=c.valueOverLifetimeLength;"_rotationCenter"===a?(s.updateFlags.rotationCenter=!0,s.updateCounts.rotationCenter=0):"_randomise"===a?s.resetFlags[t]=e:(s.updateFlags[t]=!0,s.updateCounts[t]=0),s.group._updateDefines(),this[a]=e,Array.isArray(r)&&c.utils.ensureValueOverLifetimeCompliance(s[o],i,i)})(t)}))},c.Emitter.prototype._setBufferUpdateRanges=function(e){this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;0<=t;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},c.Emitter.prototype._calculatePPSValue=function(e){var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},c.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},c.Emitter.prototype._assignValue=function(e,t){switch(e){case"position":this._assignPositionValue(t);break;case"velocity":case"acceleration":this._assignForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t)}},c.Emitter.prototype._assignPositionValue=function(e){var t=c.distributions,r=c.utils,i=this.position,a=this.attributes.position,o=i._value,s=i._spread;switch(i._distribution){case t.BOX:r.randomVector3(a,e,o,s,i._spreadClamp);break;case t.SPHERE:r.randomVector3OnSphere(a,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:r.randomVector3OnDisc(a,e,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},c.Emitter.prototype._assignForceValue=function(e,t){var r,i,a,o=c.distributions,s=c.utils,n=this[t],l=n._value,u=n._spread;switch(n._distribution){case o.BOX:s.randomVector3(this.attributes[t],e,l,u);break;case o.SPHERE:i=(r=this.attributes.position.typedArray.array)[a=3*e],s.randomDirectionVector3OnSphere(this.attributes[t],e,i,r[a+1],r[a+2],this.position._value,n._value.x,n._spread.x);break;case o.DISC:i=(r=this.attributes.position.typedArray.array)[a=3*e],s.randomDirectionVector3OnDisc(this.attributes[t],e,i,r[a+1],r[a+2],this.position._value,n._value.x,n._spread.x)}"acceleration"===t&&(o=s.clamp(s.randomFloat(this.drag._value,this.drag._spread),0,1),this.attributes.acceleration.typedArray.array[4*e+3]=o)},c.Emitter.prototype._assignAbsLifetimeValue=function(e,t){var r,i=this.attributes[t].typedArray,t=this[t],a=c.utils;a.arrayValuesAreEqual(t._value)&&a.arrayValuesAreEqual(t._spread)?(r=Math.abs(a.randomFloat(t._value[0],t._spread[0])),i.setVec4Components(e,r,r,r,r)):i.setVec4Components(e,Math.abs(a.randomFloat(t._value[0],t._spread[0])),Math.abs(a.randomFloat(t._value[1],t._spread[1])),Math.abs(a.randomFloat(t._value[2],t._spread[2])),Math.abs(a.randomFloat(t._value[3],t._spread[3])))},c.Emitter.prototype._assignAngleValue=function(e){var t,r=this.attributes.angle.typedArray,i=this.angle,a=c.utils;a.arrayValuesAreEqual(i._value)&&a.arrayValuesAreEqual(i._spread)?(t=a.randomFloat(i._value[0],i._spread[0]),r.setVec4Components(e,t,t,t,t)):r.setVec4Components(e,a.randomFloat(i._value[0],i._spread[0]),a.randomFloat(i._value[1],i._spread[1]),a.randomFloat(i._value[2],i._spread[2]),a.randomFloat(i._value[3],i._spread[3]))},c.Emitter.prototype._assignParamsValue=function(e){this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(c.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),c.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},c.Emitter.prototype._assignRotationValue=function(e){this.attributes.rotation.typedArray.setVec3Components(e,c.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),c.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},c.Emitter.prototype._assignColorValue=function(e){c.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},c.Emitter.prototype._resetParticle=function(e){for(var t,r,i=this.resetFlags,a=this.updateFlags,o=this.updateCounts,s=this.attributeKeys,n=this.attributeCount-1;0<=n;--n)r=a[t=s[n]],!0!==i[t]&&!0!==r||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===r&&o[t]===this.particleCount?(a[t]=!1,o[t]=0):1==r&&++o[t])},c.Emitter.prototype._updateAttributeUpdateRange=function(e,t){e=this.bufferUpdateRanges[e];e.min=Math.min(t,e.min),e.max=Math.max(t,e.max)},c.Emitter.prototype._resetBufferRanges=function(){for(var e,t=this.bufferUpdateRanges,r=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;0<=i;--i)t[e=r[i]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},c.Emitter.prototype._onRemove=function(){this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},c.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount},c.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount},c.Emitter.prototype._checkParticleAges=function(e,t,r,i){for(var a,o,s,n,l=t-1;e<=l;--l)0!==(n=r[a=4*l])&&(s=r[1+a],o=r[2+a],1===this.direction?o<=(s+=i)&&(n=s=0,this._decrementParticleCount()):(s-=i)<=0&&(s=o,n=0,this._decrementParticleCount()),r[a]=n,r[1+a]=s,this._updateAttributeUpdateRange("params",l))},c.Emitter.prototype._activateParticles=function(e,t,r,i){for(var a,o,s=this.direction,n=e;n<t;++n)0!=r[a=4*n]&&1!==this.particleCount||(this._incrementParticleCount(),r[a]=1,this._resetParticle(n),o=i*(n-e),r[1+a]=-1===s?r[2+a]-o:o,this._updateAttributeUpdateRange("params",n))},c.Emitter.prototype.tick=function(e){var t,r,i,a,o,s,n;this.isStatic||(null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array),r=(t=this.attributeOffset)+this.particleCount,i=this.paramsArray,a=this.particlesPerSecond*this.activeMultiplier*e,o=this.activationIndex,this._resetBufferRanges(),this._checkParticleAges(t,r,i,e),!1===this.alive?this.age=0:null!==this.duration&&this.age>this.duration?(this.alive=!1,this.age=0):(o=1===this.particleCount?o:0|o,n=(s=Math.min(o+a,this.activationEnd))-this.activationIndex|0,this._activateParticles(o,s,i,0<n?e/n:0),this.activationIndex+=a,this.activationIndex>r&&(this.activationIndex=t),this.age+=e))},c.Emitter.prototype.reset=function(e){if(this.age=0,!(this.alive=!1)===e){for(var t,r=this.attributeOffset,e=r+this.particleCount,i=this.paramsArray,a=this.attributes.params.bufferAttribute,o=e-1;r<=o;--o)i[t=4*o]=0,i[1+t]=0;a.updateRange.offset=0,a.updateRange.count=-1,a.needsUpdate=!0}return this},c.Emitter.prototype.enable=function(){return this.alive=!0,this},c.Emitter.prototype.disable=function(){return this.alive=!1,this},c.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}},{}]},{},[1]);